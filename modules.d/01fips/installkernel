#!/bin/bash

FIPSMODULES="aead aes_generic aes-x86_64 ansi_cprng cbc ccm chainiv ctr"
FIPSMODULES="$FIPSMODULES des deflate ecb eseqiv hmac seqiv sha256 sha512"
FIPSMODULES="$FIPSMODULES cryptomgr crypto_null tcrypt" 

mkdir -p "${initdir}/etc/modprobe.d"

for mod in $FIPSMODULES; do 
    if instmods $mod; then
        echo $mod >> "${initdir}/etc/fipsmodules"
        echo "blacklist $mod" >> "${initdir}/etc/modprobe.d/fips.conf"
    fi
done

# vim:ts=8:sw=4:sts=4:et
